{"ast":null,"code":"//配置路由的地方\nimport Vue from 'vue';\nimport VueRouter from 'vue-router';\nimport routes from '@/router/routes';\nimport store from '@/store'; //使用插件\n\nVue.use(VueRouter);\nlet originPush = VueRouter.prototype.push;\nlet originReplace = VueRouter.prototype.replace; //重写push｜replace\n//第一个参数：告诉原来push方法，你往哪里跳转（传递哪些参数）\n\nVueRouter.prototype.push = function (location, resolve, reject) {\n  if (resolve && reject) {\n    // call|apply区别\n    //相同点：都可以调用函数，都可以篡改函数的上下文\n    //不同点：call与apply传递参数，call传递参数用逗号隔开，appley方法执行，传递数组\n    originPush.call(this, location, resolve, reject);\n  } else {\n    originPush.call(this, location, () => {}, () => {});\n  }\n};\n\nVueRouter.prototype.replace = function (location, resolve, reject) {\n  if (resolve && reject) {\n    // call|apply区别\n    //相同点：都可以调用函数，都可以篡改函数的上下文\n    //不同点：call与apply传递参数，call传递参数用逗号隔开，appley方法执行，传递数组\n    originReplace.call(this, location, resolve, reject);\n  } else {\n    originReplace.call(this, location, () => {}, () => {});\n  }\n}; //配置路由\n\n\nconst router = new VueRouter({\n  //配置路由\n  routes,\n\n  // 路由切换滚动行为\n  scrollBehavior(to, from, savedPosition) {\n    return {\n      y: 0\n    };\n  }\n\n}); // 全局路由，路由器前置\n\nrouter.beforeEach(async (to, from, next) => {\n  // next ()\n  // 用户登录了才有token，\n  let token = store.state.user.token; // 用户信息\n\n  let name = store.state.user.userInfo.name; // 用户已经登录\n\n  if (token) {\n    // 用户已经登录不能前往login,跳转至首页 \n    if (to.path == '/login') {\n      next('/');\n    } else {\n      // 登陆了去的不是login【home|search|detail|shopcart】\n      if (name) {\n        next();\n      } else {\n        // 没有用户信息派发action让仓库存储用户信息再跳转\n        try {\n          await store.dispatch('getUserInfo');\n          next();\n        } catch (error) {\n          // token失效\n          // 清除token\n          await store.dispatch('loginOut');\n          next('/login');\n        }\n      }\n    }\n  } else {\n    // 未登录不能前往支付页面\n    if (to.path.indexOf('/trade') != -1 || to.path.indexOf('/pay') != -1 || to.path.indexOf('/paySuccess') != -1 || to.path.indexOf('/center') != -1) {\n      // 登录后返回到点击登录的页面\n      next('/login?redirect=' + to.path);\n    } else {\n      next();\n    }\n  }\n});\nexport default router;","map":{"version":3,"names":["Vue","VueRouter","routes","store","use","originPush","prototype","push","originReplace","replace","location","resolve","reject","call","router","scrollBehavior","to","from","savedPosition","y","beforeEach","next","token","state","user","name","userInfo","path","dispatch","error","indexOf"],"sources":["/Users/hcw/vueProjects/gmall/src/router/index.js"],"sourcesContent":["//配置路由的地方\nimport Vue from 'vue'\nimport VueRouter from 'vue-router'\n\nimport routes from '@/router/routes'\nimport store from '@/store'\n\n//使用插件\nVue.use(VueRouter)\n\nlet originPush = VueRouter.prototype.push\nlet originReplace = VueRouter.prototype.replace\n\n//重写push｜replace\n//第一个参数：告诉原来push方法，你往哪里跳转（传递哪些参数）\nVueRouter.prototype.push = function(location,resolve,reject) {\n    if(resolve && reject) {\n        // call|apply区别\n        //相同点：都可以调用函数，都可以篡改函数的上下文\n        //不同点：call与apply传递参数，call传递参数用逗号隔开，appley方法执行，传递数组\n        originPush.call(this,location,resolve,reject)\n    } else {\n        originPush.call(this,location,() => {},() => {})\n    }\n}\n\nVueRouter.prototype.replace = function(location,resolve,reject) {\n    if(resolve && reject) {\n        // call|apply区别\n        //相同点：都可以调用函数，都可以篡改函数的上下文\n        //不同点：call与apply传递参数，call传递参数用逗号隔开，appley方法执行，传递数组\n        originReplace.call(this,location,resolve,reject)\n    }else{\n        originReplace.call(this,location,() => {},() => {})\n    }\n}\n\n//配置路由\nconst router = new VueRouter({\n    //配置路由\n    routes,\n    // 路由切换滚动行为\n    scrollBehavior (to, from, savedPosition) {\n      return { y: 0 }\n    }\n})\n\n// 全局路由，路由器前置\nrouter.beforeEach(async (to, from, next) => {\n    // next ()\n    // 用户登录了才有token，\n    let token = store.state.user.token\n    // 用户信息\n    let name = store.state.user.userInfo.name\n    // 用户已经登录\n    if (token) {\n      // 用户已经登录不能前往login,跳转至首页 \n      if (to.path == '/login') {\n        next('/')\n      } else {\n        // 登陆了去的不是login【home|search|detail|shopcart】\n        if (name) {\n          next()\n        } else {\n          // 没有用户信息派发action让仓库存储用户信息再跳转\n          try {\n            await store.dispatch('getUserInfo')\n            next()\n          } catch (error) {\n            // token失效\n            // 清除token\n            await store.dispatch('loginOut')\n            next('/login')\n          }\n        }\n      }\n    } else {\n      // 未登录不能前往支付页面\n      if (to.path.indexOf('/trade') != -1 || to.path.indexOf('/pay') != -1 || to.path.indexOf('/paySuccess') != -1 || to.path.indexOf('/center') != -1) {\n        // 登录后返回到点击登录的页面\n        next('/login?redirect=' + to.path)\n      } else {\n        next()\n      }\n    }\n  })\n\n  export default router"],"mappings":"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"},"metadata":{},"sourceType":"module"}