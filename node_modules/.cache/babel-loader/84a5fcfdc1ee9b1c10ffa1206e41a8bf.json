{"ast":null,"code":"import _regeneratorRuntime from \"/Users/hcw/vueProjects/gmall/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/hcw/vueProjects/gmall/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.function.name.js\";\n//配置路由的地方\nimport Vue from 'vue';\nimport VueRouter from 'vue-router';\nimport routes from '@/router/routes';\nimport store from '@/store'; //使用插件\n\nVue.use(VueRouter);\nvar originPush = VueRouter.prototype.push;\nvar originReplace = VueRouter.prototype.replace; //重写push｜replace\n//第一个参数：告诉原来push方法，你往哪里跳转（传递哪些参数）\n\nVueRouter.prototype.push = function (location, resolve, reject) {\n  if (resolve && reject) {\n    // call|apply区别\n    //相同点：都可以调用函数，都可以篡改函数的上下文\n    //不同点：call与apply传递参数，call传递参数用逗号隔开，appley方法执行，传递数组\n    originPush.call(this, location, resolve, reject);\n  } else {\n    originPush.call(this, location, function () {}, function () {});\n  }\n};\n\nVueRouter.prototype.replace = function (location, resolve, reject) {\n  if (resolve && reject) {\n    // call|apply区别\n    //相同点：都可以调用函数，都可以篡改函数的上下文\n    //不同点：call与apply传递参数，call传递参数用逗号隔开，appley方法执行，传递数组\n    originReplace.call(this, location, resolve, reject);\n  } else {\n    originReplace.call(this, location, function () {}, function () {});\n  }\n}; //配置路由\n\n\nvar router = new VueRouter({\n  //配置路由\n  routes: routes,\n  // 路由切换滚动行为\n  scrollBehavior: function scrollBehavior(to, from, savedPosition) {\n    return {\n      y: 0\n    };\n  }\n}); // 全局路由，路由器前置\n\nrouter.beforeEach( /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(to, from, next) {\n    var token, name;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            // next ()\n            // 用户登录了才有token，\n            token = store.state.user.token; // 用户信息\n\n            name = store.state.user.userInfo.name; // 用户已经登录\n\n            if (!token) {\n              _context.next = 24;\n              break;\n            }\n\n            if (!(to.path == '/login')) {\n              _context.next = 7;\n              break;\n            }\n\n            next('/');\n            _context.next = 22;\n            break;\n\n          case 7:\n            if (!name) {\n              _context.next = 11;\n              break;\n            }\n\n            next();\n            _context.next = 22;\n            break;\n\n          case 11:\n            _context.prev = 11;\n            _context.next = 14;\n            return store.dispatch('getUserInfo');\n\n          case 14:\n            next();\n            _context.next = 22;\n            break;\n\n          case 17:\n            _context.prev = 17;\n            _context.t0 = _context[\"catch\"](11);\n            _context.next = 21;\n            return store.dispatch('loginOut');\n\n          case 21:\n            next('/login');\n\n          case 22:\n            _context.next = 26;\n            break;\n\n          case 24:\n            console.log(to); // 未登录不能前往支付页面\n\n            if (to.path.indexOf('/trade') != -1 || to.path.indexOf('/pay') != -1 || to.path.indexOf('/paySuccess') != -1 || to.path.indexOf('/center') != -1) {\n              // 登录后返回到点击登录的页面\n              next('/login?redirect=' + to.path);\n            } else {\n              next();\n            }\n\n          case 26:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[11, 17]]);\n  }));\n\n  return function (_x, _x2, _x3) {\n    return _ref.apply(this, arguments);\n  };\n}());\nexport default router;","map":{"version":3,"names":["Vue","VueRouter","routes","store","use","originPush","prototype","push","originReplace","replace","location","resolve","reject","call","router","scrollBehavior","to","from","savedPosition","y","beforeEach","next","token","state","user","name","userInfo","path","dispatch","console","log","indexOf"],"sources":["/Users/hcw/vueProjects/gmall/src/router/index.js"],"sourcesContent":["//配置路由的地方\nimport Vue from 'vue'\nimport VueRouter from 'vue-router'\n\nimport routes from '@/router/routes'\nimport store from '@/store'\n\n//使用插件\nVue.use(VueRouter)\n\nlet originPush = VueRouter.prototype.push\nlet originReplace = VueRouter.prototype.replace\n\n//重写push｜replace\n//第一个参数：告诉原来push方法，你往哪里跳转（传递哪些参数）\nVueRouter.prototype.push = function(location,resolve,reject) {\n    if(resolve && reject) {\n        // call|apply区别\n        //相同点：都可以调用函数，都可以篡改函数的上下文\n        //不同点：call与apply传递参数，call传递参数用逗号隔开，appley方法执行，传递数组\n        originPush.call(this,location,resolve,reject)\n    } else {\n        originPush.call(this,location,() => {},() => {})\n    }\n}\n\nVueRouter.prototype.replace = function(location,resolve,reject) {\n    if(resolve && reject) {\n        // call|apply区别\n        //相同点：都可以调用函数，都可以篡改函数的上下文\n        //不同点：call与apply传递参数，call传递参数用逗号隔开，appley方法执行，传递数组\n        originReplace.call(this,location,resolve,reject)\n    }else{\n        originReplace.call(this,location,() => {},() => {})\n    }\n}\n\n//配置路由\nconst router = new VueRouter({\n    //配置路由\n    routes,\n    // 路由切换滚动行为\n    scrollBehavior (to, from, savedPosition) {\n      return { y: 0 }\n    }\n})\n\n// 全局路由，路由器前置\nrouter.beforeEach(async (to, from, next) => {\n    // next ()\n    // 用户登录了才有token，\n    let token = store.state.user.token\n    // 用户信息\n    let name = store.state.user.userInfo.name\n    // 用户已经登录\n    if (token) {\n      // 用户已经登录不能前往login,跳转至首页 \n      if (to.path == '/login') {\n        next('/')\n      } else {\n        // 登陆了去的不是login【home|search|detail|shopcart】\n        if (name) {\n          next()\n        } else {\n          // 没有用户信息派发action让仓库存储用户信息再跳转\n          try {\n            await store.dispatch('getUserInfo')\n            next()\n          } catch (error) {\n            // token失效\n            // 清除token\n            await store.dispatch('loginOut')\n            next('/login')\n          }\n        }\n      }\n    } else {\n      console.log(to);\n      // 未登录不能前往支付页面\n      if (to.path.indexOf('/trade') != -1 || to.path.indexOf('/pay') != -1 || to.path.indexOf('/paySuccess') != -1 || to.path.indexOf('/center') != -1) {\n        // 登录后返回到点击登录的页面\n        next('/login?redirect=' + to.path)\n      } else {\n        next()\n      }\n    }\n  })\n\n  export default router"],"mappings":"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"},"metadata":{},"sourceType":"module"}